<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¼”å‡º COâ‚‚ æ°”ç“¶ç‰©æµè§„åˆ’ (å½©æ’æ¢ç“¶ç‰ˆ)</title>
    <style>
        :root {
            --primary: #7c3aed; /* ç´«è‰²ä¸»é¢˜ */
            --primary-dark: #5b21b6;
            --bg: #f3f4f6;
            --card: #ffffff;
            --text: #1f2937;
            --border: #e5e7eb;
            --success: #16a34a;
            --danger: #dc2626;
            --warning: #ca8a04;
        }

        body {
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg);
            color: var(--text);
            margin: 0;
            padding: 20px;
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        h1 { text-align: center; color: var(--primary-dark); font-weight: 800; margin-bottom: 2rem; }
        
        .main-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .card {
            background: var(--card);
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            border: 1px solid var(--border);
        }

        h2 { 
            font-size: 1.1rem; 
            border-bottom: 2px solid var(--primary); 
            padding-bottom: 8px; 
            margin-top: 0; 
            color: var(--primary-dark); 
        }

        .form-group { margin-bottom: 15px; }
        label { display: block; font-weight: 600; font-size: 0.9rem; margin-bottom: 5px; color: #4b5563; }
        
        input[type="date"], input[type="number"] {
            width: 100%; padding: 10px;
            border: 1px solid var(--border); border-radius: 8px;
            font-size: 1rem; box-sizing: border-box;
        }
        input:focus { outline: 2px solid var(--primary); border-color: transparent; }

        .checkbox-group { display: flex; flex-wrap: wrap; gap: 10px; }
        .checkbox-item {
            display: flex; align-items: center;
            background: #f9fafb; padding: 8px 12px;
            border-radius: 6px; border: 1px solid var(--border);
            font-size: 0.9rem; cursor: pointer;
        }
        .checkbox-item:hover { background: #ede9fe; border-color: var(--primary); }
        .checkbox-item input { margin-right: 8px; accent-color: var(--primary); }

        .btn {
            display: block; width: 100%; padding: 16px;
            background-color: var(--primary); color: white;
            border: none; border-radius: 10px;
            font-size: 1.1rem; font-weight: 700;
            cursor: pointer; transition: background 0.2s;
            box-shadow: 0 4px 6px rgba(124, 58, 237, 0.2);
        }
        .btn:hover { background-color: var(--primary-dark); }

        .report-section { display: none; margin-top: 30px; }
        
        .summary-box {
            background: #ecfdf5; border: 1px solid #6ee7b7;
            padding: 20px; border-radius: 10px; margin-bottom: 20px;
        }

        .alert-box {
            background: #fef2f2; border: 1px solid #fecaca; color: #991b1b;
            padding: 15px; border-radius: 10px; margin-bottom: 20px; display: none;
        }

        table { width: 100%; border-collapse: collapse; background: white; border-radius: 10px; overflow: hidden; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
        th, td { padding: 12px; text-align: center; border-bottom: 1px solid #f3f4f6; font-size: 0.9rem; }
        th { background-color: #f8fafc; font-weight: 600; color: #475569; }
        tr:last-child td { border-bottom: none; }

        .highlight-row { background-color: #f0fdf4; }
        .rehearsal-row { background-color: #fff7ed; } /* Orange tint for rehearsal day */
        .stock-low { color: var(--danger); font-weight: bold; }
        .del-badge { 
            display: inline-block; background: var(--success); color: white; 
            padding: 2px 8px; border-radius: 999px; font-size: 0.85em; font-weight: 600;
        }
        .note { font-size: 0.8em; color: #6b7280; margin-top: 4px; }
    </style>
</head>
<body>

<div class="container">
    <h1>æ¼”å‡º COâ‚‚ æ°”ç“¶ç‰©æµè§„åˆ’ (å½©æ’æ¢ç“¶ç‰ˆ)</h1>

    <div class="main-grid">
        <!-- 1. æ—¥æœŸè®¾ç½® -->
        <div class="card">
            <h2>ğŸ“… 1. æ¼”å‡ºæ—¶é—´</h2>
            <div class="form-group">
                <label>é¦–æ¼”æ—¥æœŸ (ç¬¬ä¸€å‘¨å‘¨äºŒ)</label>
                <input type="date" id="startDate">
                <div class="note">*å½“å¤©ä¸‹åˆå½©æ’ï¼Œæ™šä¸Šé¦–æ¼”</div>
            </div>
            <div class="form-group">
                <label>å½“å‰æ—¥æœŸ (è®¡ç®—èµ·ç‚¹)</label>
                <input type="date" id="currentDate">
            </div>
            <div class="form-group">
                <label>ç»“æŸæ—¥æœŸ</label>
                <input type="date" id="endDate">
            </div>
        </div>

        <!-- 2. åº“å­˜ä¸é™åˆ¶ -->
        <div class="card">
            <h2>ğŸ­ 2. åœºåœ°ä¸é™åˆ¶ (åˆ†ä½“è®¾ç½®)</h2>
            
            <div style="display:grid; grid-template-columns: 1fr 1fr; gap:15px; margin-bottom:10px;">
                <!-- 30L -->
                <div style="background:#f9fafb; padding:10px; border-radius:8px;">
                    <strong style="color:#4b5563">30L æ°”ç“¶</strong>
                    <div class="form-group" style="margin-top:5px">
                        <label>å‰§åœºå½“å‰å¤‡ç”¨ä½™é‡</label>
                        <input type="number" id="stock30" value="0" min="0" step="0.5">
                    </div>
                    <div class="form-group">
                        <label>åœºåœ°å­˜æ”¾ä¸Šé™ (ä¸ª)</label>
                        <input type="number" id="venueMax30" value="34">
                    </div>
                    <div class="form-group">
                        <label>ä¾›åº”å•†æ€»åº“å­˜</label>
                        <input type="number" id="suppMax30" value="100">
                    </div>
                </div>

                <!-- 15L -->
                <div style="background:#f9fafb; padding:10px; border-radius:8px;">
                    <strong style="color:#4b5563">15L æ°”ç“¶</strong>
                    <div class="form-group" style="margin-top:5px">
                        <label>å‰§åœºå½“å‰å¤‡ç”¨ä½™é‡</label>
                        <input type="number" id="stock15" value="0" min="0" step="0.5">
                    </div>
                    <div class="form-group">
                        <label>åœºåœ°å­˜æ”¾ä¸Šé™ (ä¸ª)</label>
                        <input type="number" id="venueMax15" value="5">
                    </div>
                    <div class="form-group">
                        <label>ä¾›åº”å•†æ€»åº“å­˜</label>
                        <input type="number" id="suppMax15" value="20">
                    </div>
                </div>
            </div>
        </div>

        <!-- 3. è¿é€è§„åˆ™ -->
        <div class="card">
            <h2>ğŸš› 3. è¿é€è§„åˆ™</h2>
            <div class="form-group">
                <label>å…è®¸é€è´§çš„æ—¥æœŸï¼š</label>
                <div class="checkbox-group" id="deliveryDays">
                    <label class="checkbox-item"><input type="checkbox" value="1"> å‘¨ä¸€</label>
                    <label class="checkbox-item"><input type="checkbox" value="2"> å‘¨äºŒ</label>
                    <label class="checkbox-item"><input type="checkbox" value="3"> å‘¨ä¸‰</label>
                    <label class="checkbox-item"><input type="checkbox" value="4"> å‘¨å››</label>
                    <label class="checkbox-item"><input type="checkbox" value="5"> å‘¨äº”</label>
                    <label class="checkbox-item"><input type="checkbox" value="6"> å‘¨å…­</label>
                    <label class="checkbox-item"><input type="checkbox" value="0"> å‘¨æ—¥</label>
                </div>
                <div class="note" style="margin-top:10px;">
                    *é¦–æ¼”æ—¥è‹¥æ— æ°”ç“¶ï¼Œç³»ç»Ÿå°†å¼ºåˆ¶å®‰æ’é€è´§ã€‚<br>
                    *ç³»ç»Ÿä¼šé˜²æ­¢åœ¨éé€è´§æ—¥æ–­ä¾›ã€‚
                </div>
            </div>
        </div>
    </div>

    <button class="btn" onclick="calculateLogistics()">å¼€å§‹è®¡ç®—</button>

    <div id="resultSection" class="report-section">
        <div id="alertBox" class="alert-box"></div>
        <div id="summaryBox" class="summary-box"></div>
        
        <div style="overflow-x: auto;">
            <table id="resultTable">
                <thead>
                    <tr>
                        <th>æ—¥æœŸ</th>
                        <th>æ˜ŸæœŸ</th>
                        <th>å®‰æ’</th>
                        <th>30Læ¶ˆè€—</th>
                        <th>15Læ¶ˆè€—</th>
                        <th>30Lè¡¥è´§</th>
                        <th>15Lè¡¥è´§</th>
                        <th>30Lç»“ä½™</th>
                        <th>15Lç»“ä½™</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>
    </div>
</div>

<script>
    // --- å¸¸é‡å®šä¹‰ ---
    // å¸¸è§„å•åœºæ¶ˆè€—
    // 30L: 2x1 + 2x0.5 + 6x0.25 = 4.5
    const SHOW_USAGE_30 = 4.5;
    // 15L: 2x0.25 = 0.5
    const SHOW_USAGE_15 = 0.5;
    
    // å…¨å¥—è¿æ¥æ•°é‡ (ç”¨äºå½©æ’æ¢ç“¶è®¡ç®—)
    // 30Lç‚¹ä½: 2+2+6 = 10ä¸ªç‚¹ä½ -> 10ç“¶
    const CONNECTED_30 = 10;
    // 15Lç‚¹ä½: 2ä¸ªç‚¹ä½ -> 2ç“¶
    const CONNECTED_15 = 2;

    const SAFETY = 2;
    const DAYS_CN = ["å‘¨æ—¥", "å‘¨ä¸€", "å‘¨äºŒ", "å‘¨ä¸‰", "å‘¨å››", "å‘¨äº”", "å‘¨å…­"];

    // --- åˆå§‹åŒ– ---
    window.onload = () => {
        const today = new Date();
        document.getElementById('startDate').valueAsDate = today;
        document.getElementById('currentDate').valueAsDate = today;
        const end = new Date(today);
        end.setDate(today.getDate() + 14);
        document.getElementById('endDate').valueAsDate = end;
    };

    // --- æ¶ˆè€—è®¡ç®—æ ¸å¿ƒé€»è¾‘ ---
    function getDailyUsage(dateObj, startDateObj) {
        const d = new Date(dateObj); d.setHours(0,0,0,0);
        const s = new Date(startDateObj); s.setHours(0,0,0,0);
        
        const diffTime = d - s;
        const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24));
        
        if (diffDays < 0) return { u30: 0, u15: 0, note: "" };

        const weekday = d.getDay();

        // åˆ¤æ–­ç¬¬ä¸€å‘¨ (é¦–æ¼”æ—¥æ‰€åœ¨å‘¨çš„å‘¨æ—¥åŠä¹‹å‰)
        const startDay = s.getDay(); // é€šå¸¸æ˜¯2
        const daysUntilSunday = startDay === 0 ? 0 : (7 - startDay);
        const isFirstWeek = diffDays <= daysUntilSunday;

        // 1. é¦–æ¼”æ—¥ (ç¬¬ä¸€å‘¨å‘¨äºŒ)
        if (diffDays === 0) {
            // é€»è¾‘ï¼šå½©æ’æ¶ˆè€—æ‰å…¨å¥—è¿æ¥ç“¶ + æ™šåœºæ¶ˆè€—å¸¸è§„é‡
            // 30L: 10 (å½©æ’æ¢æ–°) + 4.5 (æ™šåœº) = 14.5
            // 15L: 2 (å½©æ’æ¢æ–°) + 0.5 (æ™šåœº) = 2.5
            return { 
                u30: CONNECTED_30 + SHOW_USAGE_30, 
                u15: CONNECTED_15 + SHOW_USAGE_15,
                note: "å½©æ’æ¢ç“¶+é¦–æ¼”"
            };
        }

        // 2. ç¬¬ä¸€å‘¨å…¶ä»–æ—¶é—´
        if (isFirstWeek) {
            if (weekday >= 3 && weekday <= 5) { // Wed-Fri
                return { u30: SHOW_USAGE_30, u15: SHOW_USAGE_15, note: "1åœº" };
            }
            if (weekday === 6 || weekday === 0) { // Sat-Sun
                return { u30: SHOW_USAGE_30 * 2, u15: SHOW_USAGE_15 * 2, note: "2åœº" };
            }
        } 
        // 3. åç»­å‘¨
        else {
            if (weekday === 1) return { u30: 0, u15: 0, note: "ä¼‘æ¯" }; // Mon
            if (weekday >= 2 && weekday <= 5) { // Tue-Fri
                return { u30: SHOW_USAGE_30, u15: SHOW_USAGE_15, note: "1åœº" };
            }
            if (weekday === 6 || weekday === 0) { // Sat-Sun
                return { u30: SHOW_USAGE_30 * 2, u15: SHOW_USAGE_15 * 2, note: "2åœº" };
            }
        }

        return { u30: 0, u15: 0, note: "" };
    }

    // --- ä¸»è®¡ç®—å‡½æ•° ---
    function calculateLogistics() {
        // 1. è·å–è¾“å…¥
        const startDate = new Date(document.getElementById('startDate').value); startDate.setHours(0,0,0,0);
        const currDate = new Date(document.getElementById('currentDate').value); currDate.setHours(0,0,0,0);
        const endDate = new Date(document.getElementById('endDate').value); endDate.setHours(0,0,0,0);

        if (endDate < currDate) { alert("ç»“æŸæ—¥æœŸä¸èƒ½æ—©äºå½“å‰æ—¥æœŸ"); return; }

        let stock30 = parseFloat(document.getElementById('stock30').value);
        let stock15 = parseFloat(document.getElementById('stock15').value);
        
        const venueMax30 = parseInt(document.getElementById('venueMax30').value);
        const venueMax15 = parseInt(document.getElementById('venueMax15').value);
        const suppMax30 = parseInt(document.getElementById('suppMax30').value);
        const suppMax15 = parseInt(document.getElementById('suppMax15').value);

        const allowedDays = Array.from(document.querySelectorAll('#deliveryDays input:checked')).map(cb => parseInt(cb.value));
        if (allowedDays.length === 0) { alert("è¯·è‡³å°‘é€‰æ‹©ä¸€ä¸ªé€è´§æ—¥"); return; }

        // 2. è¾…åŠ©ï¼šè®¡ç®—æœªæ¥æ€»éœ€æ±‚ (ç”¨äºé¢„ç®—æ§åˆ¶-åˆšå¥½ç”¨å®Œ)
        const getFutureDemand = (fromD) => {
            let d = new Date(fromD);
            let r30 = 0, r15 = 0;
            while (d <= endDate) {
                let usage = getDailyUsage(d, startDate);
                r30 += usage.u30;
                r15 += usage.u15;
                d.setDate(d.getDate() + 1);
            }
            return { r30, r15 };
        };

        // 3. è¾…åŠ©ï¼šæ£€æŸ¥æ–­ä¾›é£é™© (Gap Risk)
        // æ£€æŸ¥ä»æ˜å¤©å¼€å§‹åˆ°ä¸‹ä¸€ä¸ªé€è´§æ—¥ä¹‹é—´ï¼Œåº“å­˜æ˜¯å¦ä¼šè€—å°½
        const checkRisk = (fromD, cur30, cur15) => {
            let d = new Date(fromD); d.setDate(d.getDate() + 1);
            let use30 = 0, use15 = 0;
            for(let i=0; i<30; i++) { // å‘å‰çœ‹30å¤©
                if(d > endDate) break;
                let u = getDailyUsage(d, startDate);
                use30 += u.u30;
                use15 += u.u15;
                
                // æ£€æŸ¥æ˜¯å¦èƒ½æ’‘ä½
                if ((cur30 - use30 < SAFETY) || (cur15 - use15 < SAFETY)) return true; // é£é™©ï¼

                // å¦‚æœé‡åˆ°é€è´§æ—¥ï¼Œä¸”æ’‘ä½äº†ï¼Œåˆ™æ— é£é™©
                if (allowedDays.includes(d.getDay())) return false;
                
                d.setDate(d.getDate() + 1);
            }
            return false; // åˆ°äº†ç»“æŸæ—¥æœŸéƒ½æ²¡é£é™©
        };

        // 4. æ¨¡æ‹Ÿå¾ªç¯
        let loopDate = new Date(currDate);
        let logs = [];
        let alerts = [];
        let totalDel30 = 0, totalDel15 = 0;
        let trips = 0;

        // æ ‡è®°æ˜¯å¦æ˜¯è®¡ç®—çš„ç¬¬ä¸€å¤©ï¼Œä¸”æ˜¯é¦–æ¼”æ—¥ (ç”¨äºå¤„ç†åˆå§‹ç©ºåº“çš„æƒ…å†µ)
        let isStart = (loopDate.getTime() === startDate.getTime());

        while(loopDate <= endDate) {
            let dateStr = loopDate.toLocaleDateString('zh-CN', {month:'2-digit', day:'2-digit'});
            let dayOfWeek = loopDate.getDay();
            let usage = getDailyUsage(loopDate, startDate);
            
            let isDeliveryDay = allowedDays.includes(dayOfWeek);

            // åˆ¤å®šé€è´§éœ€æ±‚
            // A. ç´§æ€¥ï¼šå½“å‰åº“å­˜ < æ¶ˆè€— + å®‰å…¨
            // B. é£é™©ï¼šä¸é€è´§çš„è¯ï¼Œæ’‘ä¸åˆ°ä¸‹æ¬¡é€è´§
            // C. åˆå§‹ï¼šé¦–æ¼”æ—¥ä¸”åº“å­˜ä¸è¶³ (ç‰¹ä¾‹)
            
            let urgent = (stock30 - usage.u30 < SAFETY) || (stock15 - usage.u15 < SAFETY);
            let risky = false;
            if (isDeliveryDay) {
                risky = checkRisk(loopDate, stock30 - usage.u30, stock15 - usage.u15);
            }

            let needDel = urgent || risky;
            if (isStart && urgent) needDel = true; // å¼ºåˆ¶ç¬¬ä¸€å¤©å…è®¸é€è´§å¦‚æœä¸å¤Ÿ

            let del30 = 0;
            let del15 = 0;

            if (needDel) {
                if (!isDeliveryDay && !isStart) {
                    alerts.push(`[${dateStr}] âŒ <strong>éé€è´§æ—¥æ–­ä¾›è­¦å‘Šï¼š</strong> è¯·å¢åŠ é€è´§æ—¥æˆ–åœ¨ä¸Šä¸€ä¸ªå‘¨æœŸå¤šè¿é€ï¼`);
                    // å¼ºåˆ¶è¡¥è¶³
                    del30 = Math.ceil(Math.max(0, usage.u30 + SAFETY - stock30));
                    del15 = Math.ceil(Math.max(0, usage.u15 + SAFETY - stock15));
                } else {
                    trips++;
                    // è®¡ç®—è¡¥è´§é‡ï¼šè´ªå©ªå¡«æ»¡ç­–ç•¥ (å‡å°‘é¢‘æ¬¡) + é¢„ç®—ä¸Šé™ (ä¸æµªè´¹)
                    let future = getFutureDemand(loopDate);
                    
                    // æœ€å°éœ€æ±‚ (æ´»è¿‡ä»Šå¤©)
                    let minNeed30 = Math.max(0, usage.u30 + SAFETY - stock30);
                    let minNeed15 = Math.max(0, usage.u15 + SAFETY - stock15);

                    // é¢„ç®—åˆç†ä¸Šé™ (æ€»éœ€æ±‚+å¤‡ç”¨)
                    let budgetCap30 = future.r30 + SAFETY;
                    let budgetCap15 = future.r15 + SAFETY;

                    // 30L è®¡ç®—
                    // ç›®æ ‡ = Min(ä¾›åº”å•†åº“å­˜, é¢„ç®—åˆç†ä¸Šé™)
                    // è¡¥è´§é‡ = ç›®æ ‡ - å½“å‰åº“å­˜
                    let plan30 = Math.min(suppMax30, budgetCap30) - stock30;
                    plan30 = Math.max(minNeed30, plan30); // ä¸èƒ½ä½äºæœ€å°éœ€æ±‚
                    
                    // åœºåœ°é™åˆ¶ (Venue Constraint)
                    let space30 = venueMax30 - stock30;
                    
                    // æœ€ç»ˆå†³å®š
                    if (Math.ceil(plan30) > space30) {
                        if (Math.ceil(minNeed30) > space30) {
                            alerts.push(`[${dateStr}] âš ï¸ <strong>30Låœºåœ°ç©ºé—´ä¸è¶³ï¼š</strong> æ— æ³•å­˜æ”¾æ»¡è¶³ä»Šæ—¥æ¶ˆè€—(${usage.u30})æ‰€éœ€çš„æ•°é‡ï¼`);
                            del30 = Math.ceil(minNeed30); // å¼ºåˆ¶å¡å…¥
                        } else {
                            del30 = Math.floor(space30); // å¡«æ»¡ä»“åº“
                        }
                    } else {
                        del30 = Math.ceil(plan30);
                    }

                    // 15L è®¡ç®— (åŒä¸Š)
                    let plan15 = Math.min(suppMax15, budgetCap15) - stock15;
                    plan15 = Math.max(minNeed15, plan15);
                    
                    let space15 = venueMax15 - stock15;

                    if (Math.ceil(plan15) > space15) {
                        if (Math.ceil(minNeed15) > space15) {
                            alerts.push(`[${dateStr}] âš ï¸ <strong>15Låœºåœ°ç©ºé—´ä¸è¶³ï¼š</strong> æ— æ³•å­˜æ”¾æ»¡è¶³ä»Šæ—¥æ¶ˆè€—(${usage.u15})æ‰€éœ€çš„æ•°é‡ï¼`);
                            del15 = Math.ceil(minNeed15);
                        } else {
                            del15 = Math.floor(space15);
                        }
                    } else {
                        del15 = Math.ceil(plan15);
                    }
                    
                    totalDel30 += del30;
                    totalDel15 += del15;
                }
            }

            // æ›´æ–°åº“å­˜
            stock30 = stock30 + del30 - usage.u30;
            stock15 = stock15 + del15 - usage.u15;

            logs.push({
                date: dateStr,
                day: DAYS_CN[dayOfWeek],
                note: usage.note,
                u30: usage.u30, u15: usage.u15,
                d30: del30, d15: del15,
                r30: stock30, r15: stock15
            });

            loopDate.setDate(loopDate.getDate() + 1);
            isStart = false;
        }

        // 5. è¾“å‡ºç»“æœ
        const alertBox = document.getElementById('alertBox');
        if (alerts.length > 0) {
            alertBox.innerHTML = alerts.join("<br>");
            alertBox.style.display = "block";
        } else {
            alertBox.style.display = "none";
        }

        const summaryBox = document.getElementById('summaryBox');
        let final30 = Math.max(0, stock30 - SAFETY);
        let final15 = Math.max(0, stock15 - SAFETY);
        let status = (final30 < 1 && final15 < 1) 
            ? "<span style='color:var(--success)'>âœ… å®Œç¾ (æ— æµªè´¹)</span>" 
            : "<span style='color:var(--warning)'>âš ï¸ æœ‰å°‘é‡å‰©ä½™</span>";

        summaryBox.innerHTML = `
            <strong>ğŸ“Š è§„åˆ’ç»“æœï¼š</strong><br>
            è¿é€æ¬¡æ•°ï¼š<strong>${trips}</strong> æ¬¡<br>
            è¡¥è´§æ€»é‡ï¼š30L <strong>${totalDel30}</strong> ç“¶ï¼Œ15L <strong>${totalDel15}</strong> ç“¶<br>
            æœ€ç»ˆå‰©ä½™ (é™¤å¤‡ç”¨)ï¼š30L ${final30.toFixed(1)} ç“¶ï¼Œ15L ${final15.toFixed(1)} ç“¶<br>
            çŠ¶æ€ï¼š${status}
        `;

        const tbody = document.querySelector("#resultTable tbody");
        tbody.innerHTML = "";
        logs.forEach(r => {
            let tr = document.createElement('tr');
            if (r.d30 > 0 || r.d15 > 0) tr.className = "highlight-row";
            if (r.note.includes("å½©æ’")) tr.className = "rehearsal-row";

            let d30 = r.d30 > 0 ? `<span class="del-badge">+${r.d30}</span>` : "-";
            let d15 = r.d15 > 0 ? `<span class="del-badge">+${r.d15}</span>` : "-";
            let r30c = r.r30 < SAFETY ? "stock-low" : "";
            let r15c = r.r15 < SAFETY ? "stock-low" : "";

            tr.innerHTML = `
                <td>${r.date}</td>
                <td>${r.day}</td>
                <td>${r.note}</td>
                <td>${r.u30 > 0 ? r.u30 : '-'}</td>
                <td>${r.u15 > 0 ? r.u15 : '-'}</td>
                <td>${d30}</td>
                <td>${d15}</td>
                <td class="${r30c}">${r.r30.toFixed(1)}</td>
                <td class="${r15c}">${r.r15.toFixed(1)}</td>
            `;
            tbody.appendChild(tr);
        });

        document.getElementById('resultSection').style.display = 'block';
    }
</script>

</body>
</html>
